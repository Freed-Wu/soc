option(DRY_RUN "--dry-run by default")
configure_file(config.h.in config.h)

add_library(axitangxi SHARED axitangxi.c)
install(TARGETS axitangxi LIBRARY)
add_library(utils SHARED utils.c )
install(TARGETS utils LIBRARY)
add_library(coding SHARED ArithmeticCoder.cpp BitIoStream.cpp GmmTable.cpp)
install(TARGETS coding LIBRARY)
add_library(crc SHARED crc.c)
install(TARGETS crc LIBRARY)
add_library(transmission_protocol SHARED transmission_protocol.c )
target_link_libraries(transmission_protocol crc)
target_link_libraries(transmission_protocol utils)
install(TARGETS transmission_protocol LIBRARY)

add_executable(main main.c)
target_link_libraries(main PRIVATE axitangxi)
target_link_libraries(main PRIVATE utils)
target_link_libraries(main PRIVATE transmission_protocol)
target_link_libraries(main PRIVATE coding)
find_package(Threads REQUIRED)
target_link_libraries(main PRIVATE Threads::Threads)
install(TARGETS main RUNTIME)

add_executable(master master.c)
target_link_libraries(master PRIVATE utils)
target_link_libraries(master PRIVATE transmission_protocol)
# master don't need to be installed
# install(TARGETS main RUNTIME)
